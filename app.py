# -*- coding: utf-8 -*-
# üîß –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω—É–∂–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
import streamlit as st  # üì± –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—ã
import requests         # üåê –î–ª—è –æ–±—â–µ–Ω–∏—è —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º
import json            # üìä –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
import os              # üîë –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ–∫—Ä–µ—Ç–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏
from dotenv import load_dotenv  # üìÅ –î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ .env —Ñ–∞–π–ª–∞

# üöÄ –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env —Ñ–∞–π–ª–∞
load_dotenv()  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç .env –∏–∑ —Ç–µ–∫—É—â–µ–π –ø–∞–ø–∫–∏

# üîê –ë–µ—Ä–µ–º —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏ –ò–ó .env —Ñ–∞–π–ª–∞
API_KEY = os.getenv("YANDEX_API_KEY")      # üóùÔ∏è –ö–ª—é—á –¥–æ—Å—Ç—É–ø–∞ –∫ –Ø–Ω–¥–µ–∫—Å GPT
folder_id = os.getenv("YANDEX_FOLDER_ID")  # üìÅ ID —Ç–≤–æ–µ–≥–æ –æ–±–ª–∞–∫–∞ –≤ –Ø–Ω–¥–µ–∫—Å–µ

# üö® –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∫–ª—é—á–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
if API_KEY is None or folder_id is None:
    st.error("""
    ‚ùå –û–®–ò–ë–ö–ê: –ö–ª—é—á–∏ API –Ω–µ –Ω–∞–π–¥–µ–Ω—ã!
    
    üìù –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –ø–∞–ø–∫–µ —Å –ø—Ä–æ–µ–∫—Ç–æ–º —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:
    
    ```
    YANDEX_API_KEY=–≤–∞—à_–∫–ª—é—á_–∑–¥–µ—Å—å
    YANDEX_FOLDER_ID=–≤–∞—à_folder_id_–∑–¥–µ—Å—å
    ```
    
    ‚ö†Ô∏è –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ.
    """)
    st.stop()

# üé® –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –Ω–∞—à—É —Å—Ç—Ä–∞–Ω–∏—á–∫—É
st.set_page_config(
    page_title="–ú–∞—à–∏–Ω–∞ –≤—Ä–µ–º–µ–Ω–∏",  # üìù –ù–∞–∑–≤–∞–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
    page_icon="üëë",             # üñºÔ∏è –ò–∫–æ–Ω–∫–∞ (–∫–æ—Ä–æ–Ω–∞)
    layout="wide"               # üìè –®–∏—Ä–æ–∫–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
)

# üë• –ù–∞—à–∏ –≥–ª–∞–≤–Ω—ã–µ –≥–µ—Ä–æ–∏ - –ø—Ä–∞–≤–∏—Ç–µ–ª–∏
PERSONAZHI = {
    "ivan": {  # üëë –ò–≤–∞–Ω –ì—Ä–æ–∑–Ω—ã–π
        "name": "–ò–≤–∞–Ω IV –ì—Ä–æ–∑–Ω—ã–π",
        "opisanie": "–ü–µ—Ä–≤—ã–π —Ü–∞—Ä—å –≤—Å–µ—è –†—É—Å–∏, —Å—É—Ä–æ–≤—ã–π –∏ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤—ã–π –ø—Ä–∞–≤–∏—Ç–µ–ª—å, —Å–∫–ª–æ–Ω–µ–Ω –∫ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –≥–Ω–µ–≤—É",
        "avatar": "üëë"
    },
    "petr": {  # üßî –ü–µ—Ç—Ä I
        "name": "–ü–µ—Ç—Ä I –í–µ–ª–∏–∫–∏–π",
        "opisanie": "–¶–∞—Ä—å-—Ä–µ—Ñ–æ—Ä–º–∞—Ç–æ—Ä, –ª—é–±–∏—Ç –∫–æ—Ä–∞–±–ª–∏ –∏ –Ω–∞—É–∫–∏, –≥–æ–≤–æ—Ä–∏—Ç –≥—Ä—É–±–æ–≤–∞—Ç–æ",
        "avatar": "üßî"
    },
    "ekaterina": {  # üë∏ –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ II
        "name": "–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ II –í–µ–ª–∏–∫–∞—è", 
        "opisanie": "–£–º–Ω–∞—è –∏–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞, –ª—é–±–∏—Ç –∏—Å–∫—É—Å—Å—Ç–≤–æ, –≥–æ–≤–æ—Ä–∏—Ç –∏–∑—è—â–Ω–æ",
        "avatar": "üë∏"
    }
}

# üß† –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç –æ—Ç —É–º–Ω–æ–≥–æ –Ø–Ω–¥–µ–∫—Å GPT
def poluchit_otvet_yandex(personazh, vopros):
    """
    –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è - –∫–∞–∫ –ø–æ—á—Ç–∞–ª—å–æ–Ω üöö:
    - –ë–µ—Ä–µ—Ç —Ç–≤–æ–π –≤–æ–ø—Ä–æ—Å
    - –û—Ç–Ω–æ—Å–∏—Ç –µ–≥–æ –∫ –Ø–Ω–¥–µ–∫—Å GPT
    - –ü—Ä–∏–Ω–æ—Å–∏—Ç –æ–±—Ä–∞—Ç–Ω–æ –æ—Ç–≤–µ—Ç –ø—Ä–∞–≤–∏—Ç–µ–ª—è
    """
    
    # üé≠ –ì–æ–≤–æ—Ä–∏–º AI –≤ –∫–æ–≥–æ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å—Å—è
    if personazh == "ivan":
        # üìú –°—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –ò–≤–∞–Ω–∞ –ì—Ä–æ–∑–Ω–æ–≥–æ
        system_text = "–¢—ã - —Ü–∞—Ä—å –ò–≤–∞–Ω IV –ì—Ä–æ–∑–Ω—ã–π (–≥–æ–¥—ã –∂–∏–∑–Ω–∏: 1530-1584). –ì–æ–≤–æ—Ä–∏—à—å –≥—Ä–æ–∑–Ω–æ, –≤–ª–∞—Å—Ç–Ω–æ, —Å —Ä–µ–ª–∏–≥–∏–æ–∑–Ω—ã–º–∏ –æ–±–æ—Ä–æ—Ç–∞–º–∏. –ß–∞—Å—Ç–æ —É–ø–æ–º–∏–Ω–∞–µ—à—å '–ë–æ–∂—å—é –≤–æ–ª—é', '–≥–æ—Å—É–¥–∞—Ä–µ–≤–æ –¥–µ–ª–æ'. –ú–æ–∂–µ—à—å –±—ã—Ç—å –≤—Å–ø—ã–ª—å—á–∏–≤—ã–º, –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–º, –Ω–æ —Ç–∞–∫–∂–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω–æ—Å—Ç—å. –ì–æ–≤–æ—Ä–∏ –∫–∞–∫ —á–µ–ª–æ–≤–µ–∫ –∏–∑ 16 –≤–µ–∫–∞, –∏—Å–ø–æ–ª—å–∑—É–π —Å—Ç–∞—Ä–∏–Ω–Ω—ã–µ –æ–±–æ—Ä–æ—Ç—ã: –≤–µ–ª—å–º–∏, —á–∞–¥–æ, –±–æ–ª—è—Ä–∏–Ω. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã—Ö–æ–¥–∏ –∏–∑ –æ–±—Ä–∞–∑–∞!"
    elif personazh == "petr":
        # üìú –°—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –ü–µ—Ç—Ä–∞ I
        system_text = "–¢—ã - —Ü–∞—Ä—å –ü–µ—Ç—Ä I –í–µ–ª–∏–∫–∏–π (–≥–æ–¥—ã –∂–∏–∑–Ω–∏: 1672-1725). –ì–æ–≤–æ—Ä–∏—à—å –≥—Ä—É–±–æ–≤–∞—Ç–æ –∏ –ø—Ä—è–º–æ, –∏—Å–ø–æ–ª—å–∑—É–π —Å—Ç–∞—Ä–∏–Ω–Ω—ã–µ —Å–ª–æ–≤–∞: —á–∞—é, –Ω–∞–¥–æ–±–Ω–æ, –Ω–µ–≥–æ–∂–µ. –û–±–æ–∂–∞–µ—à—å –∫–æ—Ä–∞–±–ª–∏ –∏ –Ω–∞—É–∫–∏. –ù–µ–Ω–∞–≤–∏–¥–∏—à—å —Å—Ç–∞—Ä—ã–µ –ø–æ—Ä—è–¥–∫–∏. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã—Ö–æ–¥–∏ –∏–∑ –æ–±—Ä–∞–∑–∞! –û—Ç–≤–µ—á–∞–π –∫–∞–∫ —á–µ–ª–æ–≤–µ–∫ –∏–∑ 18 –≤–µ–∫–∞."
    else:
        # üìú –°—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –ï–∫–∞—Ç–µ—Ä–∏–Ω—ã II
        system_text = "–¢—ã - –∏–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞ –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ II –í–µ–ª–∏–∫–∞—è (–≥–æ–¥—ã –∂–∏–∑–Ω–∏: 1729-1796). –ì–æ–≤–æ—Ä–∏—à—å —É–º–Ω–æ –∏ –∏–∑—è—â–Ω–æ, —Ü–∏—Ç–∏—Ä—É–π —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤: –í–æ–ª—å—Ç–µ—Ä–∞, –î–∏–¥—Ä–æ. –õ—é–±–∏—à—å –∏—Å–∫—É—Å—Å—Ç–≤–æ –∏ –Ω–∞—É–∫–∏. –ú—É–¥—Ä–∞—è –∏ –∏—Ä–æ–Ω–∏—á–Ω–∞—è. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã—Ö–æ–¥–∏ –∏–∑ –æ–±—Ä–∞–∑–∞! –û—Ç–≤–µ—á–∞–π –∫–∞–∫ —á–µ–ª–æ–≤–µ–∫ –∏–∑ 18 –≤–µ–∫–∞."
    
    # ‚úâÔ∏è –°–æ–±–∏—Ä–∞–µ–º –ø–∏—Å—å–º–æ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫ –Ø–Ω–¥–µ–∫—Å GPT
    try:
        # üéØ –ê–¥—Ä–µ—Å –∫—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
        url = "https://llm.api.cloud.yandex.net/foundationModels/v1/completion"
        
        # üìÆ –ö–æ–Ω–≤–µ—Ä—Ç —Å –Ω–∞—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
        headers = {
            "Content-Type": "application/json",      # üìÑ –ì–æ–≤–æ—Ä–∏–º —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç
            "Authorization": f"Api-Key {API_KEY}"    # üóùÔ∏è –ù–∞—à —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –ò–ó .env
        }
        
        # üìù –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∏—Å—å–º–∞
        data = {
            "modelUri": f"gpt://{folder_id}/yandexgpt-lite",  # üéØ –ö–∞–∫–∞—è –º–æ–¥–µ–ª—å AI
            "completionOptions": {
                "stream": False,      # ‚è≥ –ñ–¥–µ–º –≤–µ—Å—å –æ—Ç–≤–µ—Ç —Å—Ä–∞–∑—É
                "temperature": 0.7,   # üé® "–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ" AI (–æ—Ç 0 –¥–æ 1)
                "maxTokens": 1000     # üìè –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ça
            },
            "messages": [  # üí¨ –ù–∞—à–∞ –±–µ—Å–µ–¥–∞
                {
                    "role": "user",    # üë§ –ö—Ç–æ –ø–∏—à–µ—Ç - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (—Ç—ã)
                    "text": f"{system_text}\n\n–í–æ–ø—Ä–æ—Å –æ—Ç —É—á–µ–Ω–∏–∫–∞: {vopros}"
                }
            ]
        }
        
        # üöÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–∏—Å—å–º–æ –∏ –ø–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç
        response = requests.post(url, headers=headers, json=data)
        response.raise_for_status()  # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –æ—à–∏–±–∫–∏ HTTP
        
        # üì¶ –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç
        result = response.json()
        
        # üéÅ –î–æ—Å—Ç–∞–µ–º —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ –∏–∑ —Å–ª–æ–∂–Ω–æ–π —É–ø–∞–∫–æ–≤–∫–∏
        otvet_text = result['result']['alternatives'][0]['message']['text']
        
        return otvet_text  # üì§ –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç–≤–µ—Ç –ø—Ä–∞–≤–∏—Ç–µ–ª—è
        
    # üö® –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
    except requests.exceptions.RequestException as e:
        return f"‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –Ø–Ω–¥–µ–∫—Å GPT: {str(e)}"
    except KeyError as e:
        return f"‚ùå –û—à–∏–±–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –æ—Ç–≤–µ—Ç–∞ –æ—Ç –Ø–Ω–¥–µ–∫—Å GPT: {str(e)}"
    except Exception as e:
        return f"‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞: {str(e)}"

# ==================== –ù–ê–°–¢–†–û–ô–ö–ò CSS ====================
st.markdown("""
<style>
    /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç - –±–µ–ª—ã–π —Ñ–æ–Ω, —á–µ—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç */
    .main .block-container, 
    .stApp,
    [data-testid="stMainBlockContainer"] {
        background-color: white !important;
        color: black !important;
    }
    
    /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∏ —Ç–µ–∫—Å—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –±–ª–æ–∫–µ */
    .main h1, .main h2, .main h3, .main p, .main div, .main span,
    [data-testid="stMarkdownContainer"] {
        color: black !important;
    }
    
    /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å - —á–µ—Ä–Ω—ã–π —Ñ–æ–Ω */
    section[data-testid="stSidebar"] {
        background-color: #000000 !important;
    }
    
    /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ */
    .sidebar .sidebar-content {
        background-color: #000000 !important;
        color: white !important;
    }
    
    /* –¢–µ–∫—Å—Ç –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ */
    section[data-testid="stSidebar"] h1,
    section[data-testid="stSidebar"] h2,
    section[data-testid="stSidebar"] h3,
    section[data-testid="stSidebar"] p,
    section[data-testid="stSidebar"] div,
    section[data-testid="stSidebar"] .stMarkdown {
        color: white !important;
    }
    
    /* –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –ø—Ä–∞–≤–∏—Ç–µ–ª–µ–π - —á–µ—Ä–Ω—ã–π —Ñ–æ–Ω, –±–µ–ª—ã–π —Ç–µ–∫—Å—Ç, –º–µ–ª–∫–∏–π —à—Ä–∏—Ñ—Ç, —Ç–µ–∫—Å—Ç –ø–æ —Ü–µ–Ω—Ç—Ä—É */
    div[data-testid="stButton"] button {
        background-color: black !important;
        color: white !important;
        border: 1px solid #444 !important;
        font-size: 14px !important;
        padding: 8px 12px !important;
        min-height: auto !important;
        white-space: nowrap !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
        text-align: center !important;
        width: 100% !important;
    }
    
    /* –ö–Ω–æ–ø–∫–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
    div[data-testid="stButton"] button:hover {
        background-color: #333 !important;
        border-color: #666 !important;
    }
    
    /* –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤–æ–ø—Ä–æ—Å–∞ */
    div.stButton > button[kind="primary"] {
        background-color: #1E88E5 !important;
        color: white !important;
        font-size: 16px !important;
    }
    
    /* –ö–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ —á–∞—Ç–∞ */
    div.stButton > button[kind="secondary"] {
        background-color: #666 !important;
        color: white !important;
        font-size: 14px !important;
    }
    
    /* –°—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å —Å–æ–≤–µ—Ç–æ–º –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ */
    div[data-testid="stExpander"] details summary {
        background-color: black !important;
        color: white !important;
        border: 1px solid #444 !important;
        border-radius: 4px !important;
    }
    
    div[data-testid="stExpander"] details {
        border: 1px solid #444 !important;
        background-color: black !important;
    }
    
    div[data-testid="stExpander"] details div {
        background-color: #111 !important;
        color: white !important;
    }
    
    /* –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ */
    .stTextArea textarea {
        background-color: #f9f9f9 !important;
        color: black !important;
        border: 1px solid #ddd !important;
    }
    
    /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –±–ª–æ–∫–∏ */
    .stAlert, .stInfo, .stSuccess, .stWarning, .stError {
        background-color: #f0f0f0 !important;
        color: black !important;
    }
    
    /* –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å–Ω–∞—è –ª–∏–Ω–∏—è */
    hr {
        border-color: #ddd !important;
        margin: 1rem 0 !important;
    }
    
    /* –°—Ç–∏–ª—å –¥–ª—è expander —Å —Å–æ–≤–µ—Ç–æ–º */
    .st-emotion-cache-1hynsf2 {
        background-color: black !important;
    }
    
    /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ */
    section[data-testid="stSidebar"] .stAlert {
        background-color: black !important;
        color: white !important;
        border: 1px solid #444 !important;
    }
    
    section[data-testid="stSidebar"] .stAlert div[data-testid="stMarkdownContainer"] {
        color: white !important;
    }
</style>
""", unsafe_allow_html=True)

# ==================== –û–°–ù–û–í–ù–ê–Ø –ß–ê–°–¢–¨ –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ====================

# üè∞ –ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
st.title("üëë –ú–∞—à–∏–Ω–∞ –í—Ä–µ–º–µ–Ω–∏")
st.markdown("### ‚ú® –í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏—Ç–µ–ª—è –∏ –∑–∞–¥–∞–π –µ–º—É –≤–æ–ø—Ä–æ—Å –∏–∑ 21 –≤–µ–∫–∞!")

# üìä –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å - –≤—ã–±–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
with st.sidebar:
    st.header("üé≠ –í—ã–±–µ—Ä–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞")
    st.markdown("---")
    
    # üë• –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–∞–≤–∏—Ç–µ–ª–µ–π —Å –∫–Ω–æ–ø–∫–∞–º–∏ "–í–ø–µ—Ä–µ–¥"
    col1, col2 = st.columns(2)
    
    with col1:
        st.subheader("üëë –ò–≤–∞–Ω IV")
        if st.button("–í–ø–µ—Ä–µ–¥ ‚Üí", key="ivan_btn", use_container_width=True):
            st.session_state.vybranniy_personazh = "ivan"
            st.session_state.istorija_chata = ["üëë **–ò–≤–∞–Ω IV:** –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π, —á–∞–¥–æ! –Ø —Ü–∞—Ä—å –ò–≤–∞–Ω –í–∞—Å–∏–ª—å–µ–≤–∏—á. –û —á–µ–º –∂–µ–ª–∞–µ—à—å –≤–µ–¥–∞—Ç—å?"]
            st.rerun()
    
    with col2:
        st.subheader("üßî –ü–µ—Ç—Ä I")
        if st.button("–í–ø–µ—Ä–µ–¥ ‚Üí", key="petr_btn", use_container_width=True):
            st.session_state.vybranniy_personazh = "petr"
            st.session_state.istorija_chata = ["üßî **–ü–µ—Ç—Ä I:** –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π! –Ø –ü–µ—Ç—Ä –í–µ–ª–∏–∫–∏–π. –û —á–µ–º —Ö–æ—á–µ—à—å —Å–ø—Ä–æ—Å–∏—Ç—å?"]
            st.rerun()
    
    # –í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞ –∫–Ω–æ–ø–æ–∫
    col3, col4 = st.columns(2)
    
    with col3:
        st.subheader("üë∏ –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ II")  
        if st.button("–í–ø–µ—Ä–µ–¥ ‚Üí", key="ekat_btn", use_container_width=True):
            st.session_state.vybranniy_personazh = "ekaterina"
            st.session_state.istorija_chata = ["üë∏ **–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ II:** –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π, –º–æ–π –¥—Ä—É–≥! –Ø –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ –í–µ–ª–∏–∫–∞—è. –ß—Ç–æ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?"]
            st.rerun()
    
    with col4:
        # –ü—É—Å—Ç–∞—è –∫–æ–ª–æ–Ω–∫–∞ –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è
        st.write("")
    
    st.markdown("---")
    
    # –ö–Ω–æ–ø–∫–∞ —Å —Å–æ–≤–µ—Ç–æ–º - —á–µ—Ä–Ω–∞—è —Å –±–µ–ª—ã–º —Ç–µ–∫—Å—Ç–æ–º
    with st.expander("üí° **–°–æ–≤–µ—Ç:** –°–ø—Ä–æ—Å–∏ –æ —Ä–µ—Ñ–æ—Ä–º–∞—Ö, –≤–æ–π–Ω–∞—Ö, –Ω–∞—É–∫–∞—Ö –∏–ª–∏ –∂–∏–∑–Ω–∏ —Ç–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏!", expanded=False):
        st.markdown("""
        **–ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤:**
        
        üëë **–ò–≤–∞–Ω—É –ì—Ä–æ–∑–Ω–æ–º—É:**
        - –ó–∞—á–µ–º –í—ã –≤–≤–µ–ª–∏ –æ–ø—Ä–∏—á–Ω–∏–Ω—É?
        - –ü–æ—á–µ–º—É –í—ã –≤–∑—è–ª–∏ –ö–∞–∑–∞–Ω—å?
        
        üßî **–ü–µ—Ç—Ä—É I:**
        - –ó–∞—á–µ–º –í—ã —Ä—É–±–∏–ª–∏ –±–æ—Ä–æ–¥—ã?
        - –ü–æ—á–µ–º—É –ø–æ—Å—Ç—Ä–æ–∏–ª–∏ –ü–µ—Ç–µ—Ä–±—É—Ä–≥ –Ω–∞ –±–æ–ª–æ—Ç–∞—Ö?
        
        üë∏ **–ï–∫–∞—Ç–µ—Ä–∏–Ω–µ II:**
        - –ß—Ç–æ —Ç–∞–∫–æ–µ '–ø—Ä–æ—Å–≤–µ—â–µ–Ω–Ω—ã–π –∞–±—Å–æ–ª—é—Ç–∏–∑–º'?
        - –ü–æ—á–µ–º—É –í—ã –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–ª–∏—Å—å —Å —Ñ–∏–ª–æ—Å–æ—Ñ–∞–º–∏?
        """)
    
    st.markdown("---")
    
    # üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–≥—Ä—É–∑–∫–µ –∫–ª—é—á–µ–π
    with st.expander("üîê –°—Ç–∞—Ç—É—Å –∫–ª—é—á–µ–π"):
        if API_KEY and folder_id:
            st.success("‚úÖ –ö–ª—é—á–∏ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ .env —Ñ–∞–π–ª–∞")
            st.write(f"**Folder ID:** `{folder_id[:10]}...`")
            st.write(f"**API Key:** `{API_KEY[:10]}...`")
        else:
            st.error("‚ùå –ö–ª—é—á–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã")

# üí¨ –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å - —á–∞—Ç —Å –ø—Ä–∞–≤–∏—Ç–µ–ª–µ–º
if 'vybranniy_personazh' in st.session_state:
    # üëë –î–æ—Å—Ç–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
    personazh = st.session_state.vybranniy_personazh
    imya = PERSONAZHI[personazh]["name"]
    avatar = PERSONAZHI[personazh]["avatar"]
    
    # üé™ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ
    st.header(f"{avatar} –ë–µ—Å–µ–¥–∞ —Å {imya}")
    st.success(f"**–û –ø–µ—Ä—Å–æ–Ω–∞–∂–µ:** {PERSONAZHI[personazh]['opisanie']}")
    
    # üìú –û–±–ª–∞—Å—Ç—å –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞ (–∫–∞–∫ —Å–≤–∏—Ç–æ–∫)
    with st.container():
        st.subheader("üìú –ò—Å—Ç–æ—Ä–∏—è –≤–∞—à–µ–π –±–µ—Å–µ–¥—ã:")
        st.markdown("---")
        
        # üìù –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        for soobshenie in st.session_state.istorija_chata:
            # üé® –ö—Ä–∞—Å–∏–≤–æ –æ—Ñ–æ—Ä–º–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            if "–¢—ã:" in soobshenie:
                st.markdown(f"üéØ **{soobshenie}**")  # üë§ –°–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            else:
                st.markdown(f"{avatar} **{soobshenie.split(' ', 1)[1]}**")  # üëë –°–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∞–≤–∏—Ç–µ–ª—è
            st.markdown("---")
    
    # ‚úçÔ∏è –ü–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ –≤–æ–ø—Ä–æ—Å–∞
    with st.form(key='chat_form'):
        vopros = st.text_area(
            "üí≠ –¢–≤–æ–π –≤–æ–ø—Ä–æ—Å –ø—Ä–∞–≤–∏—Ç–µ–ª—é:",
            placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ó–∞—á–µ–º –í—ã –≤–≤–µ–ª–∏ –æ–ø—Ä–∏—á–Ω–∏–Ω—É? –ò–ª–∏: –ü–æ—á–µ–º—É –ø–æ—Å—Ç—Ä–æ–∏–ª–∏ –ü–µ—Ç–µ—Ä–±—É—Ä–≥ –Ω–∞ –±–æ–ª–æ—Ç–∞—Ö?",
            height=100
        )
        
        # üì® –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
        otpravit_btn = st.form_submit_button(
            label="üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å",
            type="primary"  # üîµ –°–∏–Ω—è—è –∫–Ω–æ–ø–∫–∞
        )
    
    # üöÄ –ï—Å–ª–∏ –Ω–∞–∂–∞–ª–∏ –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏
    if otpravit_btn and vopros.strip():
        # ‚ûï –î–æ–±–∞–≤–ª—è–µ–º –≤–æ–ø—Ä–æ—Å –≤ –∏—Å—Ç–æ—Ä–∏—é
        st.session_state.istorija_chata.append(f"–¢—ã: {vopros}")
        
        # ‚è≥ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ AI "–¥—É–º–∞–µ—Ç"
        with st.spinner(f"üîÑ {avatar} {imya} –æ–±–¥—É–º—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç..."):
            # üß† –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç –Ø–Ω–¥–µ–∫—Å GPT
            otvet = poluchit_otvet_yandex(personazh, vopros)
        
        # ‚ûï –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é
        st.session_state.istorija_chata.append(f"{avatar} **{imya}:** {otvet}")
        
        # üîÑ –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        st.rerun()
    
    # üßπ –ö–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ —á–∞—Ç–∞
    if st.button("üóëÔ∏è –ù–∞—á–∞—Ç—å –±–µ—Å–µ–¥—É –∑–∞–Ω–æ–≤–æ", type="secondary"):
        st.session_state.istorija_chata = [f"{avatar} **{imya}:** –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π! –û —á–µ–º —Ö–æ—á–µ—à—å –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å?"]
        st.rerun()

# üè† –ï—Å–ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂ –µ—â–µ –Ω–µ –≤—ã–±—Ä–∞–Ω - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
else:
    st.markdown("""
    ## üï∞Ô∏è –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ú–∞—à–∏–Ω—É –í—Ä–µ–º–µ–Ω–∏!
    
    ### üéØ –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?
    –≠—Ç–æ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç –≥–¥–µ —Ç—ã –º–æ–∂–µ—à—å **–ª–∏—á–Ω–æ –ø–æ–æ–±—â–∞—Ç—å—Å—è** —Å –≤–µ–ª–∏–∫–∏–º–∏ —Ä—É—Å—Å–∫–∏–º–∏ –ø—Ä–∞–≤–∏—Ç–µ–ª—è–º–∏!
    
    ### üéÆ –ö–∞–∫ –∏–≥—Ä–∞—Ç—å?
    1. **–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏—Ç–µ–ª—è** —Å–ª–µ–≤–∞ –≤ –º–µ–Ω—é üëà
    2. **–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å** –æ –µ–≥–æ –∂–∏–∑–Ω–∏, —Ä–µ—Ñ–æ—Ä–º–∞—Ö, —ç–ø–æ—Ö–µ  
    3. **–ü–æ–ª—É—á–∏ –æ—Ç–≤–µ—Ç** –≤ —É–Ω–∏–∫–∞–ª—å–Ω–æ–º —Å—Ç–∏–ª–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞!
    4. **–£–∑–Ω–∞–≤–∞–π –∏—Å—Ç–æ—Ä–∏—é** —á–µ—Ä–µ–∑ –∂–∏–≤–æ–π –¥–∏–∞–ª–æ–≥!
    
    ### üí° –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤:
    - **–ò–≤–∞–Ω—É –ì—Ä–æ–∑–Ω–æ–º—É:** "–ó–∞—á–µ–º –í—ã –≤–≤–µ–ª–∏ –æ–ø—Ä–∏—á–Ω–∏–Ω—É?" ‚öîÔ∏è
    - **–ò–≤–∞–Ω—É –ì—Ä–æ–∑–Ω–æ–º—É:** "–ü–æ—á–µ–º—É –í—ã –≤–∑—è–ª–∏ –ö–∞–∑–∞–Ω—å?" üè∞
    - **–ü–µ—Ç—Ä—É I:** "–ó–∞—á–µ–º –í—ã —Ä—É–±–∏–ª–∏ –±–æ—Ä–æ–¥—ã?" ‚úÇÔ∏è
    - **–ü–µ—Ç—Ä—É I:** "–ü–æ—á–µ–º—É –ø–æ—Å—Ç—Ä–æ–∏–ª–∏ –ü–µ—Ç–µ—Ä–±—É—Ä–≥ –Ω–∞ –±–æ–ª–æ—Ç–∞—Ö?" üèóÔ∏è  
    - **–ï–∫–∞—Ç–µ—Ä–∏–Ω–µ II:** "–ß—Ç–æ —Ç–∞–∫–æ–µ '–ø—Ä–æ—Å–≤–µ—â–µ–Ω–Ω—ã–π –∞–±—Å–æ–ª—é—Ç–∏–∑–º'?" üìö
    - **–ï–∫–∞—Ç–µ—Ä–∏–Ω–µ II:** "–ü–æ—á–µ–º—É –í—ã –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–ª–∏—Å—å —Å —Ñ–∏–ª–æ—Å–æ—Ñ–∞–º–∏?" ‚úâÔ∏è
    
    ### üéì –ß–µ–º—É –Ω–∞—É—á–∏—à—å—Å—è?
    - üìñ **–ò—Å—Ç–æ—Ä–∏–∏** –†–æ—Å—Å–∏–∏ 16-18 –≤–µ–∫–æ–≤
    - üí¨ **–ò—Å–∫—É—Å—Å—Ç–≤—É** –≤–µ–¥–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞  
    - ü§î **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º—É** –º—ã—à–ª–µ–Ω–∏—é
    - üé≠ **–ü–æ–Ω–∏–º–∞–Ω–∏—é** —Ä–∞–∑–Ω—ã—Ö —ç–ø–æ—Ö
    """)
    
    st.markdown("---")
    st.markdown("*–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏—Ç–µ–ª—è –≤ –±–æ–∫–æ–≤–æ–º –º–µ–Ω—é –∏ –Ω–∞—á–Ω–∏ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ –ø—Ä–æ—à–ª–æ–µ!* üöÄ")

# üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–º–æ–∂–Ω–æ —Å–∫—Ä—ã—Ç—å)
with st.expander("üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–¥–ª—è –ª—é–±–æ–∑–Ω–∞—Ç–µ–ª—å–Ω—ã—Ö)"):
    st.write("""
    **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
    - üñ•Ô∏è **Streamlit** - —Å–æ–∑–¥–∞–µ—Ç –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—É
    - üß† **Yandex GPT** - –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –∫–æ—Ç–æ—Ä—ã–π "–∏–≥—Ä–∞–µ—Ç" —Ä–æ–ª—å –ø—Ä–∞–≤–∏—Ç–µ–ª—è
    - üîê **.env —Ñ–∞–π–ª** - –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª—é—á–µ–π
    - üåê **API** - —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∫–∞–Ω–∞–ª —Å–≤—è–∑–∏ —Å AI
    
    **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
    - ‚úÖ –ö–ª—é—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º .env —Ñ–∞–π–ª–µ
    - ‚úÖ .env —Ñ–∞–π–ª –ù–ï –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ GitHub
    - ‚úÖ –ö–ª—é—á–∏ –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
    - ‚úÖ –õ–µ–≥–∫–æ –º–µ–Ω—è—Ç—å –∫–ª—é—á–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞
    """)
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏ .env
    st.write("**–°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏ .env:**")
    env_path = os.path.join(os.path.dirname(__file__), '.env')
    if os.path.exists(env_path):
        st.success(f"‚úÖ .env —Ñ–∞–π–ª –Ω–∞–π–¥–µ–Ω: `{env_path}`")
    else:
        st.warning(f"‚ö†Ô∏è .env —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `{env_path}`")

# üéØ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è session_state
if 'vybranniy_personazh' not in st.session_state:
    st.session_state.vybranniy_personazh = None
if 'istorija_chata' not in st.session_state:
    st.session_state.istorija_chata = []